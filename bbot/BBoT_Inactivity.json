{
  "name": "BBoT-Inactivity",
  "nodes": [
    {
      "parameters": {
        "amount": 7
      },
      "id": "96745e79-3fa1-4b66-aa7d-2d66285113be",
      "name": "wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -200,
        520
      ],
      "webhookId": "ba96c820-d07e-479d-9a30-9f6489ec06bb"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "01180494-a01a-48c3-a8fc-22cf89e0afb6",
              "leftValue": "={{ $json.step }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "4e612f04-18b2-4319-891d-335d2e3dc8c8",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        220,
        520
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "workflow",
        "filters": {
          "conditions": [
            {
              "keyName": "sender",
              "condition": "eq",
              "keyValue": "={{ $('Webhook').item.json.body.sender }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "step",
              "fieldValue": "end-timeout"
            }
          ]
        }
      },
      "id": "df816d9d-c894-419e-988f-54a1880e6f46",
      "name": "end-timeout",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        680,
        460
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5CV2k8yPhUBY6jzs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('parameters').item.json.endpoint }}/sendText",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "sessionKey",
              "value": "={{ $('parameters').item.json.sessionKey }}"
            },
            {
              "name": "content-type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "session",
              "value": "={{ $('parameters').item.json.session }}"
            },
            {
              "name": "number",
              "value": "={{ $('Webhook').item.json.body.sender }}"
            },
            {
              "name": "text",
              "value": "=Olá, parece que você deve estar ocupado no momento.\n\nEstou encerrando nosso atendimento, mas a qualquer momento voce pode voltar a me chamar. Basta digitar *{{ $('parameters').item.json[\"botName\"] }}*.\n\nA *{{ $('parameters').item.json[\"companyName\"] }}* agradece por entrar em contato e te esperamos em uma nova oportunidade.\n"
            }
          ]
        },
        "options": {}
      },
      "id": "42091ad9-fd74-4e02-b394-d1fdc9e911a8",
      "name": "timeout-msg",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        460,
        460
      ]
    },
    {
      "parameters": {},
      "id": "ca092b38-63bc-447a-af6f-f504ec4b368c",
      "name": "inactivity-sleep",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        -420,
        520
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "workflow",
        "filters": {
          "conditions": [
            {
              "keyName": "sender",
              "keyValue": "={{ $('Webhook').item.json.body.sender }}"
            }
          ]
        }
      },
      "id": "d4ccc389-8e9c-4930-beb2-4d7603ddf7e8",
      "name": "search-contact2",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        0,
        520
      ],
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "5CV2k8yPhUBY6jzs",
          "name": "Supabase account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "wait": {
      "main": [
        [
          {
            "node": "search-contact2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "timeout-msg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "timeout-msg": {
      "main": [
        [
          {
            "node": "end-timeout",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "inactivity-sleep": {
      "main": [
        [
          {
            "node": "wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "search-contact2": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "23031e87-3c54-41ce-a2f4-ef6a59bcf3cd",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "f529964ec142b683b8d6fb1b1061b8c872558a9ac9ba4a71dc5384e4d45db503"
  },
  "id": "8uZt6XcVQTm5fbHt",
  "tags": []
}